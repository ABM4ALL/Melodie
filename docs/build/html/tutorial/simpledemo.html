<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simplest Demo &mdash; Melodie 1.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
        <script>mermaid.initialize({startOnLoad:true});</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Model Gallery" href="../gallery/_main.html" />
    <link rel="prev" title="Tutorial" href="_main.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Melodie
            <img src="../_static/logo.jpg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation/_main.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation/_main.html#user-installation">User Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/_main.html#developer-installation">Developer Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/_main.html#dependency-note">Dependency Note</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/_main.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/abm.html">Agent-based Modeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/melodie.html">Melodie</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="_main.html">Tutorial</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Simplest Demo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#define-the-agent">Define the Agent</a></li>
<li class="toctree-l3"><a class="reference internal" href="#define-the-scenario">Define the Scenario</a></li>
<li class="toctree-l3"><a class="reference internal" href="#define-the-environment">Define the Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#define-the-model">Define the Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#load-dataframes">Load DataFrames</a></li>
<li class="toctree-l3"><a class="reference internal" href="#collect-data">Collect Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-example">Run Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="_main.html#agent">Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="_main.html#environment">Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="_main.html#datacollector">DataCollector</a></li>
<li class="toctree-l2"><a class="reference internal" href="_main.html#scenario">Scenario</a></li>
<li class="toctree-l2"><a class="reference internal" href="_main.html#model">Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="_main.html#dataframeloader">DataFrameLoader</a></li>
<li class="toctree-l2"><a class="reference internal" href="_main.html#simulator">Simulator</a></li>
<li class="toctree-l2"><a class="reference internal" href="_main.html#results">Results</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../gallery/_main.html">Model Gallery</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../gallery/game_of_life.html">Game Of Life</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gallery/technology_search.html">TechnologySearch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gallery/virus_contagion.html">VirusContagion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gallery/opinion_dynamics.html">OpinionDynamics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/_main.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/agent_and_environment.html">Agent and Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/agent_list.html">AgentList</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/model.html">Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/scenario.html">Scenario</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/data_collector.html">DataCollector</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/dataframe_loader.html">DataFrameLoader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/table_generator.html">Simulator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/simulator.html">Simulator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/calibrator.html">Calibrator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/trainer.html">Trainer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/network.html">Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grid.html">Grid</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/_main.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribution/_main.html">Contribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/_main.html">About</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Melodie</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="_main.html">Tutorial</a> &raquo;</li>
      <li>Simplest Demo</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorial/simpledemo.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="simplest-demo">
<h1>Simplest Demo<a class="headerlink" href="#simplest-demo" title="Permalink to this headline"></a></h1>
<p>It is believed that learning by an example is better than by viewing the function list of Melodie. So this example is a
simple demonstration of Gini index.</p>
<p>This example explores how “Gini index” can be influenced by the productivity of and equality among people. After
initialization, each agents get some money in their account. Then, in each period, all the agents go through following
two processes:</p>
<ul class="simple">
<li><p>MoneyProduce: randomly receive some money.</p></li>
<li><p>MoneyTransfer: in each period, there are multiple rounds (sub-periods). In each round, two agents are randomly
selected and they play a game. The winner will take 1 dollar from the loser.</p></li>
</ul>
<p>The system calculates the “total wealth” and “gini index” in each period.</p>
<p>There are two key parameters to discuss in the example:</p>
<ul class="simple">
<li><p>Productivity: the probability of agents to successfully produce some money at the beginning of each period.</p></li>
<li><p>Winning probability of richer player: in each game between two randomly selected players, the result is
probabilistically decided by a pre-defined parameter, i.e. the probability that the richer player will win the game.
With this parameter, we introduce “allocation equality” in the model</p></li>
</ul>
<p>By changing these two parameters, we can explore the following question: how is the “Gini index” influenced by the
productivity and equality in the society.</p>
<section id="define-the-agent">
<h2>Define the Agent<a class="headerlink" href="#define-the-agent" title="Permalink to this headline"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">from</span> <span class="nn">Melodie</span> <span class="kn">import</span> <span class="n">Agent</span>
<span class="kn">from</span> <span class="nn">.scenario</span> <span class="kn">import</span> <span class="n">GiniScenario</span>


<span class="k">class</span> <span class="nc">GiniAgent</span><span class="p">(</span><span class="n">Agent</span><span class="p">):</span>
    <span class="n">scenario</span><span class="p">:</span> <span class="n">GiniScenario</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">account</span> <span class="o">=</span> <span class="mf">.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">productivity</span> <span class="o">=</span> <span class="mf">.0</span>

    <span class="k">def</span> <span class="nf">go_produce</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rand</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">rand</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">productivity</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">account</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">agent_productivity</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</section>
<section id="define-the-scenario">
<h2>Define the Scenario<a class="headerlink" href="#define-the-scenario" title="Permalink to this headline"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Melodie</span> <span class="kn">import</span> <span class="n">Scenario</span>


<span class="k">class</span> <span class="nc">GiniScenario</span><span class="p">(</span><span class="n">Scenario</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">periods</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agent_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agent_account_min</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agent_account_max</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agent_productivity</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trade_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rich_win_prob</span> <span class="o">=</span> <span class="mf">0.0</span>
</pre></div>
</div>
</section>
<section id="define-the-environment">
<h2>Define the Environment<a class="headerlink" href="#define-the-environment" title="Permalink to this headline"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span>

<span class="kn">from</span> <span class="nn">Melodie</span> <span class="kn">import</span> <span class="n">AgentList</span><span class="p">,</span> <span class="n">Environment</span>
<span class="kn">from</span> <span class="nn">.scenario</span> <span class="kn">import</span> <span class="n">GiniScenario</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">.agent</span> <span class="kn">import</span> <span class="n">GiniAgent</span>


<span class="k">class</span> <span class="nc">GiniEnvironment</span><span class="p">(</span><span class="n">Environment</span><span class="p">):</span>
    <span class="n">scenario</span><span class="p">:</span> <span class="n">GiniScenario</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trade_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">trade_num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win_prob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">rich_win_prob</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_wealth</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gini</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">go_money_produce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_list</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">agent_list</span><span class="p">:</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">go_produce</span><span class="p">()</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">go_give_money</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_from</span><span class="p">:</span> <span class="s1">&#39;GiniAgent&#39;</span><span class="p">,</span> <span class="n">agent_to</span><span class="p">:</span> <span class="s1">&#39;GiniAgent&#39;</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">agent_from</span><span class="o">.</span><span class="n">account</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">agent_from</span><span class="o">.</span><span class="n">account</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">agent_to</span><span class="o">.</span><span class="n">account</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">go_money_transfer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_list</span><span class="p">:</span> <span class="s1">&#39;AgentList&#39;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">sub_period</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trade_num</span><span class="p">):</span>
            <span class="p">[</span><span class="n">agent_1</span><span class="p">,</span> <span class="n">agent_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">agent_list</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

            <span class="n">who_win</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">rand</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">rand</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_prob</span><span class="p">:</span>
                <span class="n">who_win</span> <span class="o">=</span> <span class="s1">&#39;Rich&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">who_win</span> <span class="o">=</span> <span class="s1">&#39;Poor&#39;</span>

            <span class="k">if</span> <span class="n">agent_1</span><span class="o">.</span><span class="n">account</span> <span class="o">&gt;=</span> <span class="n">agent_2</span><span class="o">.</span><span class="n">account</span> <span class="ow">and</span> <span class="n">who_win</span> <span class="o">==</span> <span class="s1">&#39;Rich&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">go_give_money</span><span class="p">(</span><span class="n">agent_2</span><span class="p">,</span> <span class="n">agent_1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">agent_1</span><span class="o">.</span><span class="n">account</span> <span class="o">&lt;</span> <span class="n">agent_2</span><span class="o">.</span><span class="n">account</span> <span class="ow">and</span> <span class="n">who_win</span> <span class="o">==</span> <span class="s1">&#39;Rich&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">go_give_money</span><span class="p">(</span><span class="n">agent_1</span><span class="p">,</span> <span class="n">agent_2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">agent_1</span><span class="o">.</span><span class="n">account</span> <span class="o">&gt;=</span> <span class="n">agent_2</span><span class="o">.</span><span class="n">account</span> <span class="ow">and</span> <span class="n">who_win</span> <span class="o">==</span> <span class="s1">&#39;Poor&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">go_give_money</span><span class="p">(</span><span class="n">agent_1</span><span class="p">,</span> <span class="n">agent_2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">agent_1</span><span class="o">.</span><span class="n">account</span> <span class="o">&lt;</span> <span class="n">agent_2</span><span class="o">.</span><span class="n">account</span> <span class="ow">and</span> <span class="n">who_win</span> <span class="o">==</span> <span class="s1">&#39;Poor&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">go_give_money</span><span class="p">(</span><span class="n">agent_2</span><span class="p">,</span> <span class="n">agent_1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">calc_gini</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Account_list</span><span class="p">):</span>

        <span class="n">x</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Account_list</span><span class="p">)</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Account_list</span><span class="p">)</span>
        <span class="n">B</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">xi</span> <span class="o">*</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">xi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">N</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">B</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calc_wealth_and_gini</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">AgentList</span><span class="p">):</span>

        <span class="n">account_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">AgentList</span><span class="p">:</span>
            <span class="n">account_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">account</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">total_wealth</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">account_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gini</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_gini</span><span class="p">(</span><span class="n">account_list</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</section>
<section id="define-the-model">
<h2>Define the Model<a class="headerlink" href="#define-the-model" title="Permalink to this headline"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Melodie</span> <span class="kn">import</span> <span class="n">Model</span>

<span class="k">class</span> <span class="nc">GiniModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">scenario</span><span class="p">:</span> <span class="s1">&#39;GiniScenario&#39;</span>
    <span class="n">environment</span><span class="p">:</span> <span class="s1">&#39;GiniEnvironment&#39;</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agent_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_agent_container</span><span class="p">(</span><span class="n">GiniAgent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">agent_num</span><span class="p">,</span>
                                                      <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">get_registered_dataframe</span><span class="p">(</span><span class="s1">&#39;agent_params&#39;</span><span class="p">))</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">define_basic_components</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">environment</span> <span class="o">=</span> <span class="n">GiniEnvironment</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_collector</span> <span class="o">=</span> <span class="n">GiniDataCollector</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># for t in range(0, self.scenario.periods):</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">routine</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">go_money_produce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">go_money_transfer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">calc_wealth_and_gini</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_collector</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">step</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">agent_productivity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_collector</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="load-dataframes">
<h2>Load DataFrames<a class="headerlink" href="#load-dataframes" title="Permalink to this headline"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlalchemy</span>

<span class="kn">from</span> <span class="nn">Melodie</span> <span class="kn">import</span> <span class="n">DataFrameLoader</span>


<span class="k">class</span> <span class="nc">GiniDataframeLoader</span><span class="p">(</span><span class="n">DataFrameLoader</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">register_scenario_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">scenarios_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_dataframe</span><span class="p">(</span><span class="s1">&#39;simulator_scenarios&#39;</span><span class="p">,</span> <span class="s1">&#39;simulator_scenarios.xlsx&#39;</span><span class="p">,</span> <span class="n">scenarios_dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">register_generated_dataframes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_generator</span><span class="p">(</span><span class="s1">&#39;agent_params&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">scenario</span><span class="p">:</span> <span class="n">scenario</span><span class="o">.</span><span class="n">agent_num</span><span class="p">)</span> <span class="k">as</span> <span class="n">g</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">generator_func</span><span class="p">(</span><span class="n">scenario</span><span class="p">:</span> <span class="s2">&quot;GiniScenario&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">increment</span><span class="p">(),</span>
                    <span class="s1">&#39;productivity&#39;</span><span class="p">:</span> <span class="n">scenario</span><span class="o">.</span><span class="n">agent_productivity</span><span class="p">,</span>
                    <span class="s1">&#39;account&#39;</span><span class="p">:</span> <span class="mf">0.0</span>
                <span class="p">}</span>

            <span class="n">g</span><span class="o">.</span><span class="n">set_row_generator</span><span class="p">(</span><span class="n">generator_func</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">set_column_data_types</span><span class="p">({</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">Integer</span><span class="p">(),</span>
                <span class="s1">&#39;productivity&#39;</span><span class="p">:</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">Float</span><span class="p">(),</span>
                <span class="s1">&#39;account&#39;</span><span class="p">:</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">Float</span><span class="p">()</span>
            <span class="p">})</span>
</pre></div>
</div>
</section>
<section id="collect-data">
<h2>Collect Data<a class="headerlink" href="#collect-data" title="Permalink to this headline"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="kn">from</span> <span class="nn">Melodie</span> <span class="kn">import</span> <span class="n">DataCollector</span>


<span class="k">class</span> <span class="nc">GiniDataCollector</span><span class="p">(</span><span class="n">DataCollector</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_agent_property</span><span class="p">(</span><span class="s1">&#39;agent_list&#39;</span><span class="p">,</span> <span class="s1">&#39;account&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_property</span><span class="p">(</span><span class="s1">&#39;trade_num&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_property</span><span class="p">(</span><span class="s1">&#39;win_prob&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_property</span><span class="p">(</span><span class="s1">&#39;total_wealth&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_property</span><span class="p">(</span><span class="s1">&#39;gini&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="run-example">
<h2>Run Example<a class="headerlink" href="#run-example" title="Permalink to this headline"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">simulator</span> <span class="o">=</span> <span class="n">Simulator</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
                      <span class="n">scenario_cls</span><span class="o">=</span><span class="n">GiniScenario</span><span class="p">,</span>
                      <span class="n">model_cls</span><span class="o">=</span><span class="n">GiniModel</span><span class="p">,</span>
                      <span class="n">df_loader_cls</span><span class="o">=</span><span class="n">GiniDataframeLoader</span><span class="p">)</span>

<span class="n">simulator</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="_main.html" class="btn btn-neutral float-left" title="Tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../gallery/_main.html" class="btn btn-neutral float-right" title="Model Gallery" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2022, ABM4ALL.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>